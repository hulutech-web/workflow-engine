name: Update Contributors
on:
  schedule:
    - cron: '0 */6 * * *'  # æ¯6å°æ—¶è¿è¡Œä¸€æ¬¡ï¼ˆå‡å°‘APIè°ƒç”¨é¢‘ç‡ï¼‰
  workflow_dispatch:
  push:
    branches: [ master ]

jobs:
  update-contributors:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # å…è®¸å·¥ä½œæµæ¨é€æ›´æ”¹

    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # ä½¿ç”¨æ›´ç¨³å®šçš„è´¡çŒ®è€…ç”Ÿæˆå·¥å…·
      - name: Generate Contributors
        uses: jasonlong/contributors-script@v1
        with:
          repo: hulutech-web/workflow-engine
          columns: 7
          image-size: 80
          template: |
            <table>
              <tr>{{#contributors}}
                <td align="center">
                  <a href="{{html_url}}">
                    <img src="{{avatar_url}}" width="{{image-size}}px;" alt=""/>
                    <br/>
                    <sub><b>{{login}}</b></sub>
                  </a>
                </td>{{/contributors}}
              </tr>
            </table>

      # æ›´æ–°README
      - name: Update README
        run: |
          # å°†ç”Ÿæˆçš„CONTRIBUTORS.mdå†…å®¹æ’å…¥åˆ°README
          awk -v new="$(cat CONTRIBUTORS.md)" '
            /<!-- CONTRIBUTORS-LIST:START -->/,/<!-- CONTRIBUTORS-LIST:END -->/ {
              if (/START/) {print; print new; next}
              if (/END/) next
            }
            {print}
          ' README.md > README.tmp && mv README.tmp README.md

      # ä»…å½“æœ‰å˜åŒ–æ—¶æäº¤
      - name: Commit changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add README.md
          git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸ“Œ Auto-update contributors" && git push)